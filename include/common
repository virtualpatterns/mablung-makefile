
# --mablung-makefile-include-path := $(patsubst %/,%,$(dir $(realpath $(lastword $(MAKEFILE_LIST)))))
# $(info --mablung-makefile-include-path := $(--mablung-makefile-include-path))
											
ifeq ($(CURDIR),$(project-path))

.PHONY: install reinstall clean run test pre-release release

install::
	@npm install

reinstall::
	@rm -Rf node_modules package-lock.json
	@npm install
	@$(MAKE) commit message=post-reinstall

clean::
	@npx shx rm -Rf coverage process release

run:: build
	$(eval export MAKEFILE_PATH := $(realpath $(MAKEFILE_LIST)))
	@node --no-warnings --unhandled-rejections=strict $(or $(argument),$(arg),$(a))

test:: build
	$(eval export MAKEFILE_PATH := $(realpath $(MAKEFILE_LIST)))
	@npx shx rm -Rf coverage process
	@npx c8 ava $(or $(argument),$(arg),$(a))

pre-release:: update reinstall clean test
	@$(MAKE) commit message=post-pre-release

release:: export source-map := false
release:: clean build
	@npm version prerelease
	@npm publish --access public
	@git push origin master

endif